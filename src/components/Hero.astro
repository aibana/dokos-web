---
import Icon from './Icon.astro';
import AppMockup from './AppMockup.astro';
import type { Translations } from '../i18n/utils';

interface Props {
  t: Translations;
}

const { t } = Astro.props;
---

<section class="relative min-h-screen flex items-center overflow-hidden hero-mesh" aria-labelledby="hero-heading">
  <!-- Ambient orbs -->
  <div id="hero-orbs" class="absolute inset-0 pointer-events-none z-0 overflow-hidden" aria-hidden="true">
    <div class="orb orb-1"></div>
    <div class="orb orb-2"></div>
    <div class="orb orb-3"></div>
    <div class="orb orb-4"></div>
    <div class="orb orb-5"></div>
  </div>

  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 relative z-10">
    <div class="grid grid-cols-1 lg:grid-cols-2 gap-12 items-center">
      <div class="text-center lg:text-left">
        <div class="inline-flex items-center gap-2 px-3 py-1 rounded-full bg-primary/10 border border-primary/20 text-primary text-xs font-semibold uppercase tracking-wider mb-6">
          <span class="w-2 h-2 rounded-full bg-primary animate-pulse"></span> {t.hero.badge}
        </div>

        <h1 id="hero-heading" class="text-4xl md:text-5xl lg:text-6xl font-extrabold tracking-tight leading-tight mb-6">
          {t.hero.titleLine1} <br />
          <span class="text-transparent bg-clip-text bg-gradient-to-r from-primary to-accent-neon">{t.hero.titleLine2}</span> <br />
          {t.hero.titleLine3}
        </h1>

        <p class="mt-4 text-lg text-slate-600 dark:text-slate-400 max-w-2xl mx-auto lg:mx-0 mb-8 leading-relaxed">
          {t.hero.subtitle}
        </p>

        <div class="flex flex-col sm:flex-row gap-4 justify-center lg:justify-start">
          <button
            id="hero-download-btn"
            class="inline-flex items-center justify-center px-6 py-3 border border-transparent text-base font-medium rounded-lg text-white bg-primary hover:bg-primary-dark shadow-lg shadow-primary/25 transition-all cursor-pointer"
            data-label-mac={t.hero.downloadForMac}
            data-label-windows={t.hero.downloadForWindows}
            data-label-linux={t.hero.downloadForLinux}
          >
            <Icon name="download" class="mr-2" />
            <span id="download-label">{t.hero.downloadForMac}</span>
          </button>
          <button
            id="hero-store-btn"
            class="inline-flex items-center justify-center px-6 py-3 border border-slate-200 dark:border-slate-700 text-base font-medium rounded-lg text-slate-700 dark:text-slate-200 bg-white dark:bg-surface-dark hover:bg-slate-50 dark:hover:bg-slate-800 transition-all cursor-pointer"
            data-label-windows={t.common.getOnWindowsStore}
            data-label-apple={t.common.getOnAppStore}
          >
            <Icon name="storefront" class="mr-2" />
            <span id="store-label">{t.common.getOnWindowsStore}</span>
          </button>
        </div>

        <div class="mt-6 flex items-center justify-center lg:justify-start gap-4 text-slate-400 dark:text-slate-500">
          <div class="flex items-center gap-1.5 text-xs font-medium">
            <Icon name="desktop_windows" size="text-base" /> {t.hero.windows}
          </div>
          <div class="flex items-center gap-1.5 text-xs font-medium">
            <Icon name="laptop_mac" size="text-base" /> {t.hero.macOS}
          </div>
          <div class="flex items-center gap-1.5 text-xs font-medium">
            <Icon name="terminal" size="text-base" /> {t.hero.linux}
          </div>
        </div>
      </div>

      <div class="relative lg:h-[500px] flex items-center justify-center">
        <div class="absolute inset-0 bg-primary/20 blur-3xl rounded-full transform scale-75" aria-hidden="true"></div>
        <AppMockup />
      </div>
    </div>
  </div>
</section>

<style>
  .orb {
    position: absolute;
    border-radius: 50%;
    filter: blur(20px);
    will-change: transform;
  }

  .orb-1 {
    width: 400px;
    height: 400px;
    background: rgba(19, 91, 236, 0.08);
    top: 10%;
    left: -5%;
    animation: drift-1 25s ease-in-out infinite;
  }

  .orb-2 {
    width: 350px;
    height: 350px;
    background: rgba(16, 185, 129, 0.06);
    top: 40%;
    right: -8%;
    animation: drift-2 30s ease-in-out infinite;
  }

  .orb-3 {
    width: 300px;
    height: 300px;
    background: rgba(19, 91, 236, 0.05);
    bottom: 15%;
    left: 30%;
    animation: drift-3 22s ease-in-out infinite;
  }

  .orb-4 {
    width: 250px;
    height: 250px;
    background: rgba(139, 92, 246, 0.06);
    top: 60%;
    left: 10%;
    animation: drift-4 28s ease-in-out infinite;
  }

  .orb-5 {
    width: 320px;
    height: 320px;
    background: rgba(16, 185, 129, 0.05);
    top: 5%;
    right: 20%;
    animation: drift-5 35s ease-in-out infinite;
  }

  @keyframes drift-1 {
    0%, 100% { transform: translate(0, 0) scale(1); }
    25% { transform: translate(80px, 60px) scale(1.1); }
    50% { transform: translate(40px, 120px) scale(0.95); }
    75% { transform: translate(-30px, 50px) scale(1.05); }
  }

  @keyframes drift-2 {
    0%, 100% { transform: translate(0, 0) scale(1); }
    25% { transform: translate(-70px, -40px) scale(1.08); }
    50% { transform: translate(-100px, 30px) scale(0.92); }
    75% { transform: translate(-40px, -80px) scale(1.03); }
  }

  @keyframes drift-3 {
    0%, 100% { transform: translate(0, 0) scale(1); }
    33% { transform: translate(60px, -50px) scale(1.12); }
    66% { transform: translate(-50px, -30px) scale(0.9); }
  }

  @keyframes drift-4 {
    0%, 100% { transform: translate(0, 0) scale(1); }
    20% { transform: translate(50px, -70px) scale(1.06); }
    50% { transform: translate(90px, -30px) scale(0.94); }
    80% { transform: translate(30px, 40px) scale(1.1); }
  }

  @keyframes drift-5 {
    0%, 100% { transform: translate(0, 0) scale(1); }
    30% { transform: translate(-60px, 80px) scale(1.08); }
    60% { transform: translate(40px, 50px) scale(0.93); }
    80% { transform: translate(-20px, 100px) scale(1.05); }
  }
</style>

<script>
  // Platform-aware download button label
  const btn = document.getElementById('hero-download-btn');
  const label = document.getElementById('download-label');
  if (btn && label) {
    const ua = navigator.userAgent;
    if (/Windows/.test(ua)) {
      label.textContent = btn.dataset.labelWindows || label.textContent;
    } else if (/Linux/.test(ua) && !/Android/.test(ua)) {
      label.textContent = btn.dataset.labelLinux || label.textContent;
    }
  }

  // Platform-aware store button label
  const storeBtn = document.getElementById('hero-store-btn');
  const storeLabel = document.getElementById('store-label');
  if (storeBtn && storeLabel) {
    const ua = navigator.userAgent;
    if (/Macintosh|iPhone|iPad|iPod/.test(ua)) {
      storeLabel.textContent = storeBtn.dataset.labelApple || storeLabel.textContent;
    }
  }

  // Wire both hero buttons to open the download modal
  document.getElementById('hero-download-btn')?.addEventListener('click', () => {
    const fn = (window as any).openDownloadModal;
    if (typeof fn === 'function') fn();
  });
  document.getElementById('hero-store-btn')?.addEventListener('click', () => {
    const fn = (window as any).openDownloadModal;
    if (typeof fn === 'function') fn();
  });

  // Pause orb animations when Hero is out of viewport
  const orbs = document.getElementById('hero-orbs');
  if (orbs) {
    const obs = new IntersectionObserver(([entry]) => {
      orbs.style.animationPlayState = entry.isIntersecting ? 'running' : 'paused';
      for (const child of orbs.children) {
        (child as HTMLElement).style.animationPlayState = entry.isIntersecting ? 'running' : 'paused';
      }
    });
    obs.observe(orbs);
  }
</script>
